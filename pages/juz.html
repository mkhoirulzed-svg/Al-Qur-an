<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juz</title>

<link rel="stylesheet" href="../style.css">
</head>

<body>

<header class="app-header">
  <button onclick="history.back()">←</button>
  <span id="judul">Juz</span>
</header>

<main class="container" id="juzContent">
  <p>Memuat juz...</p>
</main>

<script src="../data/juz-map.js"></script>
<script>
const juzNo = Number(new URLSearchParams(location.search).get('no'));
const juzContent = document.getElementById('juzContent');
const judul = document.getElementById('judul');

judul.textContent = `Juz ${juzNo}`;

const juzInfo = JUZ_MAP.find(j => j.juz === juzNo);

if (!juzInfo) {
  juzContent.innerHTML = '<p>Juz tidak valid</p>';
} else {
  loadJuz(juzInfo);
}

/* =========================
   TAJWID COLOR (SAMA)
========================= */
function tajwidColor(text) {
  return text
    .replace(/([اوي])/g, '<span class="tajwid-mad">$1</span>')
    .replace(/([نم]ْ)/g, '<span class="tajwid-idgham">$1</span>')
    .replace(/([قطبجد])/g, '<span class="tajwid-qalqalah">$1</span>');
}

async function loadJuz({ start, end }) {
  juzContent.innerHTML = '';

  for (let surah = start[0]; surah <= end[0]; surah++) {
    try {
      const res = await fetch(`https://equran.id/api/v2/surat/${surah}`);
      const json = await res.json();

      /* =========================
         HEADER SURAH
      ========================= */
      const header = document.createElement('div');
      header.className = 'surah-header';
      header.innerHTML = `
        <h3>${json.data.namaLatin}</h3>
        <small>${json.data.arti}</small>
      `;
      juzContent.appendChild(header);

      
      /* =========================
   BISMILLAH
   - hanya di awal surah
   - bukan awal juz di tengah surah
   - kecuali Al-Fatihah & At-Taubah
========================= */
const isFirstSurahInJuz = surah === start[0];
const isStartFromAyat1 = start[1] === 1;

if (
  json.data.nomor !== 1 &&
  json.data.nomor !== 9 &&
  (!isFirstSurahInJuz || isStartFromAyat1)
) {
  const bismillah = document.createElement('div');
  bismillah.className = 'bismillah ayat-arab';
  bismillah.innerHTML =
    json.data.bismillah?.teksArab ||
    'بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ';
  juzContent.appendChild(bismillah);
}

      /* =========================
         AYAT (STYLE SAMA SURAH)
      ========================= */
      json.data.ayat.forEach(a => {
        const ayatNo = a.nomorAyat;

        const isStartSurah = surah === start[0];
        const isEndSurah   = surah === end[0];

        if (
          (isStartSurah && ayatNo < start[1]) ||
          (isEndSurah && ayatNo > end[1])
        ) return;

        const div = document.createElement('div');
        div.className = 'ayat-item';
        div.innerHTML = `
          <div class="ayat-arab">${tajwidColor(a.teksArab)}</div>
          <div class="ayat-indo">${a.teksIndonesia}</div>
          <div class="ayat-nomor">
            ${json.data.namaLatin} : ${ayatNo}
          </div>
        `;
        juzContent.appendChild(div);
      });

    } catch (e) {
      juzContent.innerHTML = '<p>Gagal memuat juz</p>';
    }
  }
}
</script>

</body>
</html>