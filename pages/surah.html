<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surah</title>

<link rel="stylesheet" href="../style.css">
</head>

<body>

<header class="app-header">
  <button onclick="history.back()">â†</button>
  <span id="judul">Surah</span>
</header>

<main class="container" id="ayatList">
  <p>Memuat ayat...</p>
</main>

<script>
const params = new URLSearchParams(window.location.search);
const no = Number(params.get('no'));
const ayatList = document.getElementById('ayatList');
const judul = document.getElementById('judul');

fetch(`https://equran.id/api/v2/surat/${no}`)
  .then(res => res.json())
  .then(res => {
    const s = res.data;
    judul.textContent = s.namaLatin;
    ayatList.innerHTML = '';

    /* =========================
       TAJWID COLOR
    ========================= */
    function tajwidColor(text) {
      return text
        .replace(/([Ø§ÙˆÙŠ])/g, '<span class="tajwid-mad">$1</span>')
        .replace(/([Ù†Ù…]Ù’)/g, '<span class="tajwid-idgham">$1</span>')
        .replace(/([Ù‚Ø·Ø¨Ø¬Ø¯])/g, '<span class="tajwid-qalqalah">$1</span>');
    }

    /* =========================
       BISMILLAH
       - tampil di awal surah
       - kecuali Al-Fatihah (1) & At-Taubah (9)
    ========================= */
    if (s.nomor !== 1 && s.nomor !== 9) {
      const bismillah = document.createElement('div');
      bismillah.className = 'bismillah ayat-arab';
      bismillah.innerHTML =
        s.bismillah?.teksArab ||
        'Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù';
      ayatList.appendChild(bismillah);
    }

    /* =========================
       AYAT-AYAT
    ========================= */
    s.ayat.forEach(a => {
      const div = document.createElement('div');
      div.className = 'ayat-item';
div.dataset.surah = s.nomor;
div.dataset.surahName = s.namaLatin;
div.dataset.ayat = a.nomorAyat;
div.dataset.text = a.teksArab;
      div.innerHTML = `
  <div class="ayat-header">
    <span class="ayat-nomor">${a.nomorAyat}</span>
    <button class="bookmark-btn" title="Bookmark ayat">ğŸ”–</button>
  </div>

  <div class="ayat-arab">${tajwidColor(a.teksArab)}</div>
  <div class="ayat-indo">${a.teksIndonesia}</div>
      `;
      ayatList.appendChild(div);
    });

  })
  .catch(() => {
    ayatList.innerHTML = '<p>Gagal memuat ayat</p>';
  });


document.addEventListener('click', function (e) {
  if (!e.target.classList.contains('bookmark-btn')) return;

  const ayatEl = e.target.closest('.ayat-item');

  const bookmark = {
    mode: 'surah',
    surah: ayatEl.dataset.surah,
    surahName: ayatEl.dataset.surahName,
    ayat: ayatEl.dataset.ayat,
    text: ayatEl.dataset.text
  };

  let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];

  const sudahAda = bookmarks.some(b =>
    b.surah == bookmark.surah && b.ayat == bookmark.ayat
  );

  if (sudahAda) {
    alert('Ayat ini sudah dibookmark');
    return;
  }

  bookmarks.push(bookmark);
  localStorage.setItem('bookmarks', JSON.stringify(bookmarks));

  e.target.classList.add('active');
});
</script>

</body>
</html>